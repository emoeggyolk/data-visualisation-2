{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 600,
  "height": 400,
  "background": "#f8fafc",
  "title": {
    "text": "Total Births in Malaysia (2017â€“2022)",
    "fontSize": 20,
    "color": "#000000"
  },

  "data": {
    "url": "https://raw.githubusercontent.com/emoeggyolk/data-visualisation-2/refs/heads/main/data/births.csv"
  },

  "transform": [
    { "calculate": "year(toDate(datum.date))", "as": "year" },
    { "filter": "datum.year >= 2017 && datum.year <= 2022" },
    {
      "aggregate": [{ "op": "sum", "field": "births", "as": "total_births" }],
      "groupby": ["year"]
    }
  ],

  "layer": [
    {
      "mark": {
        "type": "line",
        "point": { "filled": true, "size": 80, "color": "#377eb8" },
        "strokeWidth": 3,
        "color": "#1f78b4"
      },
      "encoding": {
        "x": {
          "field": "year",
          "type": "ordinal",
          "title": "Year",
          "axis": { "labelAngle": 0, "tickCount": 6 }
        },
        "y": {
          "field": "total_births",
          "type": "quantitative",
          "title": "Total Births",
          "axis": { "format": "," },
          "scale": { "domain": [400000, 550000] }
        },
        "tooltip": [
          { "field": "year", "title": "Year" },
          { "field": "total_births", "title": "Total Births", "format": "," }
        ]
      }
    },

    {
      "transform": [
        { "window": [{ "op": "rank", "as": "r" }], "sort": [{ "field": "total_births", "order": "descending" }] },
        { "filter": "datum.r == 1" }
      ],
      "mark": {
        "type": "text",
        "align": "center",
        "baseline": "bottom",
        "dy": -10,
        "fontSize": 13,
        "fontWeight": "bold",
        "color": "#000000"
      },
      "encoding": {
        "x": { "field": "year", "type": "ordinal" },
        "y": { "field": "total_births", "type": "quantitative" },
        "text": {
          "field": "total_births",
          "type": "quantitative",
          "format": ",",
          "title": "Highest"
        }
      }
    },

    {
      "transform": [
        {
          "window": [{ "op": "rank", "as": "r" }],
          "sort": [{ "field": "total_births", "order": "descending" }]
        },
        { "filter": "datum.r == 1" }
      ],
      "mark": {
        "type": "text",
        "align": "center",
        "baseline": "bottom",
        "dy": -28,
        "fontSize": 11,
        "fontStyle": "italic",
        "color": "#000000"
      },
      "encoding": {
        "x": { "field": "year", "type": "ordinal" },
        "y": { "field": "total_births", "type": "quantitative" },
        "text": { "value": "Highest" }
      }
    },

    {
      "transform": [
        { "window": [{ "op": "rank", "as": "r" }], "sort": [{ "field": "total_births", "order": "ascending" }] },
        { "filter": "datum.r == 1" }
      ],
      "mark": {
        "type": "text",
        "align": "center",
        "baseline": "top",
        "dy": 15,
        "fontSize": 13,
        "fontWeight": "bold",
        "color": "#d62728"
      },
      "encoding": {
        "x": { "field": "year", "type": "ordinal" },
        "y": { "field": "total_births", "type": "quantitative" },
        "text": {
          "field": "total_births",
          "type": "quantitative",
          "format": ",",
          "title": "Lowest"
        }
      }
    },

    {
      "transform": [
        {
          "window": [{ "op": "rank", "as": "r" }],
          "sort": [{ "field": "total_births", "order": "ascending" }]
        },
        { "filter": "datum.r == 1" }
      ],
      "mark": {
        "type": "text",
        "align": "center",
        "baseline": "top",
        "dy": 30,
        "fontSize": 11,
        "fontStyle": "italic",
        "color": "#d62728"
      },
      "encoding": {
        "x": { "field": "year", "type": "ordinal" },
        "y": { "field": "total_births", "type": "quantitative" },
        "text": { "value": "Lowest" }
      }
    }
  ],

  "config": {
    "view": { "stroke": null },
    "axis": { "labelFontSize": 12, "titleFontSize": 12 },
    "title": { "font": "Arial", "fontSize": 16 }
  }
}
